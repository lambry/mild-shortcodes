var Lambry={};!function($){Lambry.Shorts={init:function(i){_this=Lambry.Shorts,this.$wrap=$("#lambry-shorts"),this.$wrap.find(".ls-loading").addClass("is-hidden"),this.$wrap.append(i),this.initSelect(this.$wrap.find("select")),this.$wrap.find(".sortable").sortable({placeholder:"clone-gap"}),this.cache(),this.events(),this.showLinks()},cache:function(){this.$home=this.$wrap.find(".home"),this.$section=this.$wrap.find(".shortcode"),this.$link=this.$wrap.find(".shortcode-link"),this.$links=this.$wrap.find(".shortcode-links"),this.$clone=this.$wrap.find(".clone")},events:function(){this.$home.on("click",this.showLinks),this.$link.on("click",this.showSection),this.$clone.on("click",this.cloneFields),this.$section.on("submit",this.createShortcode)},showLinks:function(){_this.$section.removeClass("is-visible"),setTimeout(function(){_this.$section.hide(),_this.$links.fadeIn(100,function(){_this.$links.addClass("is-visible")})},300)},initSelect:function(i){i.select2({width:"100%",templateResult:function(i){return $(i.element).parent().hasClass("icon")?$('<span><i class="fa fa-'+i.id+'"></i> '+i.text+"</span>"):i.text}})},showSection:function(){_this.$links.removeClass("is-visible");var i=$(this).data("shortcode");setTimeout(function(){_this.$links.hide(),_this.$wrap.find("#"+i).fadeIn(100,function(){_this.$wrap.find("#"+i).addClass("is-visible")})},300)},cloneFields:function(){$this=$(this);var i=$this.parents(".shortcode").find(".field-wrap"),t=i.find(".fields:last-child").clone();t.find("input").val(""),t.find(".select2").remove(),t.appendTo(i),_this.initSelect(i.find("select"))},createShortcode:function(i){i.preventDefault(),$this=_this.$wrap.find("form.is-visible");var t=window.parent.tinyMCE,s=t.activeEditor,e=$this.data("code"),n=$this.data("wrap"),h=$this.data("child"),o="";1===n&&h&&(o+="["+e+"]<br>"),o+=h?_this.createCodes($this,e,h):_this.createAttributes($this,e),1===n&&(o+=" "+s.selection.getContent()+" [/"+e+"]"),t&&(t.execCommand("mceInsertContent",!1,o),s.windowManager.close())},createCodes:function(i,t,s){var e="";return i.find(".fields").each(function(i,t){e+=_this.createAttributes($(this),s),e+=" [/"+s+"]<br>"}),e},createAttributes:function(i,t){var s="";return i.find(".input, .check:checked").each(function(i,t){var e=$(t).val();e&&(s+=" "+t.name+'="'+e+'"')}),"["+t+s+"]"}}}(jQuery);